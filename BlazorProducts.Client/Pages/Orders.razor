@page "/orders"
@attribute [Authorize(Roles = "Administrator")]
@using BlazorProducts.Client.Component
@using BlazorProducts.Client.Component.ProductTable
@using Entities.Models
@using Microsoft.AspNetCore.Authorization

<div class="row">
    <div class="col-md-5">
        <Search OnSearchChanged="() => {}" />
    </div>
    <div class="col-md-5">
        <Sort OnSortChanged="() => {}" />
    </div>
    <div class="col-md-2">
        <a href="/orders/createOrder">Create Order</a>
    </div>
</div>
<div class="row">
    <table class="table">
        <thead>
            <tr>
                <th>Order ID</th>
                <th>Customer Name</th>
                <th>Products</th>
                <th>Order Date</th>
                <th>Total</th>
                <th>Status</th>
                <th>Actions</th>
                <!-- Add more table headers as needed -->
            </tr>
        </thead>
        <tbody>
            @foreach (var order in OrderList)
            {
                <tr data-toggle="collapse" data-target="#orderDetails-@order.Id" aria-expanded="false" aria-controls="orderDetails-@order.Id">
                    <td>@order.Id</td>
                    <td>@order.CustomerName</td>
                    <td>
                        <div>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Image</th>
                                        <th>Product Name</th>
                                        <th>Quantity</th>
                                        <!-- Add more table headers as needed -->
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var orderProduct in order.OrderProducts)
                                    {
                                        <tr>
                                            <td>
                                                <img src="@orderProduct.Product.ImageUrl" alt="product image" style="width:100px;" />
                                            </td>
                                            <td>@orderProduct.Product.Name</td>
                                            <td>@orderProduct.Quantity</td>
                                            <!-- Add more table cells for additional product details -->
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                        
                    </td>
                    <td>@order.OrderDate.ToShortDateString()</td>
                    <td>@order.OrderTotal</td>
                    <td>@order.Status</td>
                    <td>
                        <select id="orderStatus" class="mb-5" @onchange="(e) => UpdateOrderStatus(order,  (int)Enum.Parse<OrderStatus>(e.Value.ToString()))">
                            @foreach (OrderStatus status in Enum.GetValues(typeof(OrderStatus)))
                            {
                                <option value="@status">@status</option>
                            }
                        </select>
                    </td>
                    <!-- Add more table cells for additional order details -->
                </tr>
            }
        </tbody>
    </table>
</div>
